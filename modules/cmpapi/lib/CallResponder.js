"use strict";var __read=this&&this.__read||function(o,e){var n="function"==typeof Symbol&&o[Symbol.iterator];if(!n)return o;var t,a,i=n.call(o),s=[];try{for(;(void 0===e||e-- >0)&&!(t=i.next()).done;)s.push(t.value)}catch(o){a={error:o}}finally{try{t&&!t.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return s},__spread=this&&this.__spread||function(){for(var o=[],e=0;e<arguments.length;e++)o=o.concat(__read(arguments[e]));return o};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CallResponder=exports.API_KEY=void 0;var command_1=require("./command"),CommandMap_1=require("./command/CommandMap"),CmpApiModel_1=require("./CmpApiModel"),Disabled_1=require("./response/Disabled"),SupportedVersions_1=require("./SupportedVersions");exports.API_KEY="__tcfapi";var CallResponder=function(){function o(o){this.customCommands=o;try{this.callQueue=window[exports.API_KEY]()}catch(o){this.callQueue=[]}finally{window[exports.API_KEY]=this.apiCall.bind(this)}this.purgeQueuedCalls()}return o.prototype.apiCall=function(o,e,n){for(var t,a=[],i=3;i<arguments.length;i++)a[i-3]=arguments[i];if("string"!=typeof o)n(null,!1);else if(SupportedVersions_1.SupportedVersions.has(e)){if("function"!=typeof n)throw new Error("invalid callback function");CmpApiModel_1.CmpApiModel.disabled?n(new Disabled_1.Disabled,!1):this.isCustomCommand(o)||this.isBuiltInCommand(o)?this.isCustomCommand(o)&&!this.isBuiltInCommand(o)?(t=this.customCommands)[o].apply(t,__spread([n],a)):o===command_1.TCFCommand.PING?this.isCustomCommand(o)?new CommandMap_1.CommandMap[o](this.customCommands[o],a[0],null,n):new CommandMap_1.CommandMap[o](n,a[0]):void 0===CmpApiModel_1.CmpApiModel.tcModel?this.callQueue.push(__spread([o,e,n],a)):this.isCustomCommand(o)&&this.isBuiltInCommand(o)?new CommandMap_1.CommandMap[o](this.customCommands[o],a[0],null,n):new CommandMap_1.CommandMap[o](n,a[0]):n(null,!1)}else n(null,!1)},o.prototype.purgeQueuedCalls=function(){var o=this.apiCall.bind(this),e=this.callQueue;this.callQueue=[],e.forEach((function(e){o.apply(void 0,__spread(e))}))},o.prototype.isCustomCommand=function(o){return this.customCommands&&"function"==typeof this.customCommands[o]},o.prototype.isBuiltInCommand=function(o){return void 0!==CommandMap_1.CommandMap[o]},o}();exports.CallResponder=CallResponder;